// Generated by CoffeeScript 1.3.3
(function() {
  var api, get_friend_info, get_random_friend, https;

  https = require('https');

  api = function(path, callback) {
    var buffer, options, parse;
    buffer = '';
    options = {
      host: 'graph.facebook.com',
      path: path,
      method: 'GET'
    };
    https.get(options, function(res) {
      res.setEncoding('utf8');
      res.on('data', function(data) {
        return buffer += data.toString();
      });
      res.on('error', function(e) {
        return console.log(e);
      });
      return res.on('end', parse);
    });
    return parse = function() {
      var json;
      json = JSON.parse(buffer);
      return callback(json);
    };
  };

  get_random_friend = function(token, callback) {
    var path;
    path = "/fql?q=SELECT+uid,+name+FROM+user+WHERE+uid+IN+(SELECT+uid2+FROM+friend+WHERE+uid1+=+me())+ORDER+BY+rand()+limit+1&access_token=" + token;
    return api(path, function(friend) {
      return callback(friend.data);
    });
  };

  get_friend_info = function(uid, token, callback) {
    var path;
    path = "/" + uid + "?access_token=" + token;
    return api(path, function(friend) {
      return callback(friend);
    });
  };

  exports.get_friend = function(token, callback) {
    return get_random_friend(token, function(friend) {
      var uid;
      uid = friend[0].uid;
      return get_friend_info(uid, token, function(friend) {
        return callback(friend);
      });
    });
  };

}).call(this);
