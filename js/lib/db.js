// Generated by CoffeeScript 1.3.3
(function() {
  var config, mapMissions, nano;

  config = require('../config');

  nano = require('nano')(config.db);

  exports.findUser = function(id, callback) {
    var users;
    users = nano.db.use('users');
    return users.get(id, function(err, body) {
      if (err) {
        return callback(err);
      }
    });
  };

  exports.saveUser = function(id, data, callback) {
    var users;
    users = nano.db.use('users');
    return users.insert(data, id, function(err, body) {
      if (err) {
        return console.log(err);
      } else if (typeof callback === 'function') {
        return callback(body.id);
      }
    });
  };

  mapMissions = function(row) {
    var mission;
    mission = row.doc;
    delete mission._id;
    delete mission._rev;
    return mission;
  };

  exports.getMissions = function(callback) {
    var missions;
    missions = nano.db.use('missions');
    return missions.list({
      include_docs: true
    }, function(err, body) {
      if (!err) {
        missions = body.rows.map(mapMissions);
        return callback(missions);
      }
    });
  };

  exports.saveMission = function(json, callback) {
    var missions;
    missions = nano.db.use('missions');
    return missions.insert(json, null, function(err, body) {
      if (!err) {
        return callback(body.id);
      }
    });
  };

}).call(this);
