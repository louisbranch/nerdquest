// Generated by CoffeeScript 1.3.3
(function() {

  Nerd.QuestFinalView = Backbone.View.extend({
    className: 'quest-final',
    initialize: function() {
      _.bindAll(this, 'render');
      this.template = _.template($('#quest-final-template').html());
      return this.render();
    },
    render: function() {
      var $canvas, rendered;
      $canvas = $('.quest-canvas');
      rendered = this.template(this.model.toJSON());
      $(this.el).html(rendered);
      $canvas.html(this.el);
      return this;
    }
  });

  Nerd.QuestView = Backbone.View.extend({
    className: 'quest-canvas',
    initialize: function() {
      _.bindAll(this, 'render', 'renderSuspects', 'renderFinal');
      this.model.bind('finalLevel', this.renderSuspects);
      this.model.bind('finished', this.renderFinal);
      this.template = _.template($('#quest-template').html());
      return this.render();
    },
    render: function() {
      var $canvas, rendered;
      $canvas = $('.quest-canvas');
      rendered = this.template(this.model.toJSON());
      $(this.el).html(rendered);
      $canvas.replaceWith(this.el);
      return this;
    },
    renderSuspects: function() {
      var suspects;
      suspects = this.model.get('suspects');
      return new Nerd.SuspectsView({
        collection: suspects
      });
    },
    renderFinal: function() {
      return new Nerd.QuestFinalView({
        model: this.model
      });
    }
  });

  Nerd.QuestRowView = Backbone.View.extend({
    tagName: 'li',
    className: 'quest',
    initialize: function() {
      _.bindAll(this, 'render');
      return this.template = _.template($('#quest-row-template').html());
    },
    events: function() {
      return {
        'click': 'start'
      };
    },
    render: function() {
      var rendered;
      rendered = this.template(this.model.toJSON());
      $(this.el).html(rendered);
      return this;
    },
    start: function() {
      new Nerd.QuestView({
        model: this.model
      });
      return this.model.start(function(result) {
        var nextWorlds;
        new Nerd.WorldView({
          model: result.firstWorld
        });
        nextWorlds = new Nerd.Worlds(result.nextWorlds);
        return new Nerd.WorldsListView({
          collection: nextWorlds
        });
      });
    }
  });

  Nerd.QuestListView = Backbone.View.extend({
    tagName: 'section',
    className: 'quest-log',
    initialize: function() {
      _.bindAll(this, 'render');
      this.template = _.template($('#quest-list-template').html());
      this.collection.bind('reset', this.render);
      return this.render();
    },
    render: function() {
      var $quests;
      $(this.el).html(this.template({}));
      $quests = this.$('.quests');
      this.collection.each(function(quest) {
        var view;
        view = new Nerd.QuestRowView({
          model: quest,
          collection: this.collection
        });
        return $quests.append(view.render().el);
      });
      return this;
    }
  });

}).call(this);
